# diffguard configuration file
# For more information, see: https://github.com/effortlessmetrics/diffguard

# =============================================================================
# Suppression Directives
# =============================================================================
# Suppress findings with inline comments in your code:
#
#   // diffguard: ignore rust.no_unwrap
#   let x = y.unwrap();                     // <- this line is suppressed
#
#   let x = y.unwrap(); // diffguard: ignore rust.no_unwrap  // <- same line
#
#   // diffguard: ignore-next-line rust.no_dbg
#   dbg!(value);                            // <- next line is suppressed
#
#   // diffguard: ignore rule1, rule2       // <- multiple rules
#
#   // diffguard: ignore *                  // <- wildcard: suppress all rules
#   // diffguard: ignore-all                // <- same as ignore *
#
# Suppression comments work with any comment syntax:
#   Python/Shell: # diffguard: ignore ...
#   JS/Rust/Go:   // diffguard: ignore ...
#
# Per-directory overrides:
#   Place `.diffguard.toml` files in subdirectories to adjust rule behavior
#   for that subtree only. Example `src/legacy/.diffguard.toml`:
#
#     [[rule]]
#     id = "rust.no_unwrap"
#     severity = "warn"
#
# =============================================================================

[defaults]
base = "origin/main"
scope = "added"         # added|changed|modified|deleted (changed kept for compatibility)
fail_on = "error"       # error|warn|never
max_findings = 200
diff_context = 0

[[rule]]
id = "rust.no_unwrap"
severity = "error"
message = "Avoid unwrap/expect in production code."
languages = ["rust"]
patterns = ["\\.unwrap\\(", "\\.expect\\("]
paths = ["**/*.rs"]
exclude_paths = ["**/tests/**", "**/benches/**", "**/examples/**"]
ignore_comments = true
ignore_strings = true

[[rule]]
id = "rust.no_dbg"
severity = "warn"
message = "Remove dbg!/println! before merging."
languages = ["rust"]
patterns = ["\\bdbg!\\(", "\\bprintln!\\(", "\\beprintln!\\("]
paths = ["**/*.rs"]
exclude_paths = ["**/tests/**", "**/benches/**", "**/examples/**"]
ignore_comments = true
ignore_strings = true

[[rule]]
id = "ruby.no_puts"
severity = "warn"
message = "Remove puts/p debug statements before merging."
languages = ["ruby"]
patterns = ["\\bputs\\b", "\\bp\\s+[^=]"]
paths = ["**/*.rb"]
exclude_paths = ["**/spec/**", "**/test/**"]
ignore_comments = true
ignore_strings = true

# -----------------------------------------------------------------------------
# Advanced semantics examples
# -----------------------------------------------------------------------------

# [[rule]]
# id = "python.eval_untrusted"
# severity = "warn"
# message = "eval() with untrusted input is forbidden."
# languages = ["python"]
# patterns = ["\\beval\\s*\\("]
# paths = ["**/*.py"]
# ignore_comments = true
# ignore_strings = true
#
# # Multi-line matching across consecutive scoped lines
# multiline = true
# multiline_window = 2
#
# # Require nearby context
# context_patterns = ["\\buntrusted\\b"]
# context_window = 2
#
# # Escalate when additional context appears
# escalate_patterns = ["\\brequest\\.(GET|POST|data)\\b"]
# escalate_window = 1
# escalate_to = "error"
#
# # Only run after dependency rules matched in the same file
# depends_on = ["python.has_eval"]
#
# # Negative matching: emit when pattern is absent in the scoped file
# # match_mode = "absent"
