{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ConfigFile",
  "description": "The on-disk configuration file.",
  "type": "object",
  "properties": {
    "defaults": {
      "$ref": "#/$defs/Defaults",
      "default": {
        "base": "origin/main",
        "diff_context": 0,
        "fail_on": "error",
        "head": "HEAD",
        "max_findings": 200,
        "scope": "added"
      }
    },
    "includes": {
      "description": "Include other config files. Paths are relative to this config file's directory.\nRules are merged: later definitions override earlier ones by rule ID.",
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "rule": {
      "type": "array",
      "default": [],
      "items": {
        "$ref": "#/$defs/RuleConfig"
      }
    }
  },
  "$defs": {
    "Defaults": {
      "type": "object",
      "properties": {
        "base": {
          "type": [
            "string",
            "null"
          ]
        },
        "diff_context": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint32",
          "minimum": 0
        },
        "fail_on": {
          "anyOf": [
            {
              "$ref": "#/$defs/FailOn"
            },
            {
              "type": "null"
            }
          ]
        },
        "head": {
          "type": [
            "string",
            "null"
          ]
        },
        "max_findings": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint32",
          "minimum": 0
        },
        "scope": {
          "anyOf": [
            {
              "$ref": "#/$defs/Scope"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "FailOn": {
      "type": "string",
      "enum": [
        "error",
        "warn",
        "never"
      ]
    },
    "RuleConfig": {
      "type": "object",
      "properties": {
        "exclude_paths": {
          "description": "Exclude path globs.",
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "help": {
          "description": "Optional help text explaining how to fix violations.",
          "type": [
            "string",
            "null"
          ]
        },
        "id": {
          "type": "string"
        },
        "ignore_comments": {
          "type": "boolean",
          "default": false
        },
        "ignore_strings": {
          "type": "boolean",
          "default": false
        },
        "languages": {
          "description": "Optional language tags (e.g. \"rust\"). Empty means \"all\".",
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "message": {
          "type": "string"
        },
        "paths": {
          "description": "Include path globs. Empty means \"all\".",
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "patterns": {
          "description": "One or more regex patterns.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "severity": {
          "$ref": "#/$defs/Severity"
        },
        "tags": {
          "description": "Tags for grouping/filtering rules (e.g., \"debug\", \"security\", \"style\").",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "test_cases": {
          "description": "Test cases for validating this rule.",
          "type": "array",
          "items": {
            "$ref": "#/$defs/RuleTestCase"
          }
        },
        "url": {
          "description": "Optional URL with more information about the rule.",
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "id",
        "severity",
        "message",
        "patterns"
      ]
    },
    "RuleTestCase": {
      "description": "A test case for validating a rule's behavior.",
      "type": "object",
      "properties": {
        "description": {
          "description": "Optional: description of what this test case validates.",
          "type": [
            "string",
            "null"
          ]
        },
        "ignore_comments": {
          "description": "Optional: override ignore_comments for this test case.",
          "type": [
            "boolean",
            "null"
          ]
        },
        "ignore_strings": {
          "description": "Optional: override ignore_strings for this test case.",
          "type": [
            "boolean",
            "null"
          ]
        },
        "input": {
          "description": "The input line to test against the rule.",
          "type": "string"
        },
        "language": {
          "description": "Optional: specify a language for preprocessing (e.g., \"rust\", \"python\").",
          "type": [
            "string",
            "null"
          ]
        },
        "should_match": {
          "description": "Whether the rule should match this input.",
          "type": "boolean"
        }
      },
      "required": [
        "input",
        "should_match"
      ]
    },
    "Scope": {
      "type": "string",
      "enum": [
        "added",
        "changed",
        "modified",
        "deleted"
      ]
    },
    "Severity": {
      "type": "string",
      "enum": [
        "info",
        "warn",
        "error"
      ]
    }
  }
}